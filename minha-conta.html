<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Conta | Laméd vs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Allura&family=Cormorant+Garamond:wght@300;500;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

    <style>
        :root { --cor-marrom: #643f21; --cor-ouro: #A58A5C; }
        body { font-family: 'Inter', sans-serif; background: #fff; color: #374151; }
        .serif { font-family: 'Cormorant Garamond', serif; }
        .font-allura { font-family: 'Allura', cursive; }
        
        /* Transições de View */
        .auth-view { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .auth-view.active { display: block; opacity: 1; }
        
        /* Input Chique */
        .input-chic {
            width: 100%; border-bottom: 1px solid #e5e7eb; padding: 12px 0;
            outline: none; transition: border-color 0.3s; background: transparent;
            font-size: 0.9rem; color: #1f2937;
        }
        .input-chic:focus { border-color: var(--cor-ouro); }
        .input-chic::placeholder { color: #9ca3af; }
        
        /* Botão Chique */
        .btn-chic {
            width: 100%; background: var(--cor-marrom); color: white;
            padding: 14px; font-weight: 500; letter-spacing: 0.05em;
            text-transform: uppercase; font-size: 0.8rem;
            transition: background 0.3s, transform 0.2s;
        }
        .btn-chic:hover { background: #4a2e18; transform: translateY(-1px); }

        .tab-btn.active { border-bottom: 2px solid var(--cor-marrom); color: var(--cor-marrom); font-weight: 600; }
        
        /* Chat */
        .msg-user { background: #f3f4f6; border-radius: 12px 12px 0 12px; margin-left: auto; padding: 10px 15px; max-width: 80%; }
        .msg-admin { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px 12px 12px 0; padding: 10px 15px; max-width: 80%; }

        /* Upload Overlay */
        .avatar-container:hover .avatar-overlay { opacity: 1; }
        .avatar-overlay { opacity: 0; transition: opacity 0.2s; background: rgba(0,0,0,0.5); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- ÁREA DE AUTENTICAÇÃO (LOGIN / CADASTRO) -->
    <div id="auth-container" class="flex-1 flex flex-col items-center justify-center p-6 hidden">
        <div class="w-full max-w-md">
            <div class="text-center mb-10">
                <a href="index.html" class="inline-block group">
                    <h1 class="font-allura text-6xl text-[--cor-marrom] group-hover:opacity-90 transition">Laméd</h1>
                    <span class="text-xs tracking-[0.3em] text-[--cor-ouro] uppercase mt-2 block font-serif">Alfaiataria & Casa</span>
                </a>
            </div>

            <!-- LOGIN VIEW -->
            <div id="view-login" class="auth-view active">
                <h2 class="serif text-3xl font-light mb-8 text-center text-gray-800">Bem-vindo de volta</h2>
                
                <form id="login-form" class="space-y-6">
                    <div>
                        <label class="text-[10px] uppercase text-gray-400 tracking-widest font-bold">E-mail</label>
                        <input type="email" id="login-email" class="input-chic" required>
                    </div>
                    <div>
                        <label class="text-[10px] uppercase text-gray-400 tracking-widest font-bold">Senha</label>
                        <input type="password" id="login-pass" class="input-chic" required>
                    </div>
                    <button type="submit" class="btn-chic shadow-lg">Entrar</button>
                </form>

                <div class="mt-8 space-y-6">
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-100"></div></div>
                        <div class="relative flex justify-center text-xs"><span class="px-2 bg-white text-gray-400">OU</span></div>
                    </div>

                    <button onclick="fazerLoginGoogle()" class="w-full border border-gray-200 py-3 flex items-center justify-center gap-3 hover:bg-gray-50 transition text-sm text-gray-600">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5">
                        Continuar com Google
                    </button>
                    <p class="text-center text-sm text-gray-500">
                        Ainda não possui conta? <button onclick="switchAuthView('register')" class="text-[--cor-marrom] font-medium underline">Cadastrar-se</button>
                    </p>
                </div>
            </div>

            <!-- REGISTER VIEW -->
            <div id="view-register" class="auth-view">
                <h2 class="serif text-3xl font-light mb-2 text-center text-gray-800">Criar Conta</h2>
                <p class="text-center text-gray-400 text-sm mb-8 font-light">Preencha seus dados para uma experiência personalizada.</p>
                
                <form id="register-form" class="space-y-5">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="reg-nome" placeholder="Nome" class="input-chic" required>
                        <input type="text" id="reg-sobrenome" placeholder="Sobrenome" class="input-chic" required>
                    </div>
                    <input type="email" id="reg-email" placeholder="E-mail" class="input-chic" required>
                    <input type="tel" id="reg-phone" placeholder="WhatsApp (DDD + Número)" class="input-chic" required>
                    <input type="password" id="reg-pass" placeholder="Senha" class="input-chic" required>
                    
                    <div class="pt-4">
                        <p class="text-[10px] text-gray-400 uppercase mb-3 font-bold tracking-widest">Endereço de Entrega</p>
                        <div class="grid grid-cols-3 gap-3 mb-2">
                            <input type="text" id="reg-cep" placeholder="CEP" class="input-chic col-span-1" onblur="buscarEndereco(this.value)">
                            <input type="text" id="reg-cidade" placeholder="Cidade" class="input-chic col-span-2">
                        </div>
                        <input type="text" id="reg-rua" placeholder="Rua" class="input-chic mb-2">
                        <input type="text" id="reg-numero" placeholder="Número / Compl." class="input-chic">
                    </div>

                    <button type="submit" class="btn-chic mt-6 shadow-lg">Finalizar Cadastro</button>
                </form>
                
                <p class="text-center text-sm text-gray-500 mt-8">
                    Já tem conta? <button onclick="switchAuthView('login')" class="text-[--cor-marrom] font-medium underline">Entrar</button>
                </p>
            </div>
        </div>
    </div>

    <!-- PAINEL DO USUÁRIO -->
    <div id="user-panel" class="hidden flex-1 flex flex-col">
        <header class="bg-white border-b border-gray-100 sticky top-0 z-30">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <a href="index.html" class="flex items-center gap-2 text-gray-400 hover:text-[--cor-marrom] transition">
                    <i class="fa-solid fa-arrow-left"></i> <span class="text-xs uppercase tracking-widest font-medium">Voltar à Loja</span>
                </a>
                <div class="flex items-center gap-4">
                    <div class="text-right hidden sm:block">
                        <p id="user-name-display" class="font-medium text-sm text-gray-800">Usuario</p>
                    </div>
                    <img id="user-avatar-display" src="" class="w-10 h-10 rounded-full border border-gray-100 object-cover shadow-sm">
                    <button onclick="fazerLogout()" class="text-gray-400 hover:text-red-500 ml-2" title="Sair"><i class="fa-solid fa-power-off"></i></button>
                </div>
            </div>
            
            <nav class="flex justify-center gap-4 sm:gap-8 mt-2 overflow-x-auto">
                <button onclick="switchTab('pedidos')" class="tab-btn active py-4 text-xs uppercase tracking-widest text-gray-400 hover:text-[--cor-marrom] transition whitespace-nowrap">Pedidos</button>
                <button onclick="switchTab('favoritos')" class="tab-btn py-4 text-xs uppercase tracking-widest text-gray-400 hover:text-[--cor-marrom] transition whitespace-nowrap">Favoritos</button>
                <button onclick="switchTab('dados')" class="tab-btn py-4 text-xs uppercase tracking-widest text-gray-400 hover:text-[--cor-marrom] transition whitespace-nowrap">Meus Dados</button>
                <button onclick="switchTab('chat')" class="tab-btn py-4 text-xs uppercase tracking-widest text-gray-400 hover:text-[--cor-marrom] transition whitespace-nowrap">Suporte</button>
            </nav>
        </header>

        <main class="container mx-auto p-4 md:p-8 max-w-4xl flex-1 bg-white">
            
            <!-- PEDIDOS -->
            <div id="tab-pedidos" class="tab-content space-y-6">
                <div id="orders-list" class="space-y-4">
                    <p class="text-center text-gray-400 py-10">Carregando pedidos...</p>
                </div>
            </div>

            <!-- FAVORITOS (NOVO) -->
            <div id="tab-favoritos" class="tab-content hidden">
                <h3 class="serif text-2xl mb-6 text-gray-800 border-b pb-2">Meus Favoritos</h3>
                <div id="favorites-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <p class="col-span-full text-center text-gray-400 py-10">Você ainda não tem peças favoritas.</p>
                </div>
            </div>

            <!-- MEUS DADOS (PERFIL) -->
            <div id="tab-dados" class="tab-content hidden">
                <div class="max-w-xl mx-auto mt-8">
                    <h3 class="serif text-2xl mb-8 text-center text-gray-800">Editar Perfil</h3>
                    <form id="profile-form" class="space-y-8">
                        
                        <!-- Upload de Imagem -->
                        <div class="flex flex-col items-center gap-4 mb-8">
                            <div class="relative w-24 h-24 avatar-container cursor-pointer">
                                <img id="profile-edit-avatar" src="" class="w-full h-full rounded-full object-cover border-4 border-gray-50 shadow-md">
                                <div class="absolute inset-0 rounded-full avatar-overlay flex items-center justify-center text-white" onclick="document.getElementById('file-upload-profile').click()">
                                    <i class="fa-solid fa-camera text-xl"></i>
                                </div>
                                <input type="file" id="file-upload-profile" class="hidden" accept="image/*" onchange="uploadFotoPerfil(this)">
                            </div>
                            <div class="w-full text-center">
                                <span class="text-xs text-gray-400">Clique na foto para alterar ou cole o link abaixo</span>
                            </div>
                            <div class="w-full">
                                <label class="text-[10px] uppercase text-gray-400 font-bold tracking-widest">URL da Foto</label>
                                <input type="url" id="profile-photo-url" class="input-chic text-sm" placeholder="Cole o link da sua foto aqui">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label class="text-[10px] uppercase text-gray-400 font-bold tracking-widest">Nome Completo</label><input type="text" id="profile-nome" class="input-chic"></div>
                            <div><label class="text-[10px] uppercase text-gray-400 font-bold tracking-widest">Telefone / WhatsApp</label><input type="text" id="profile-phone" class="input-chic"></div>
                        </div>

                        <div class="pt-6 border-t border-gray-100">
                            <h4 class="serif text-lg mb-4 text-gray-600">Endereço de Entrega</h4>
                            <div class="grid grid-cols-3 gap-4 mb-4">
                                <input type="text" id="profile-cep" placeholder="CEP" class="input-chic col-span-1" onblur="buscarEndereco(this.value)">
                                <input type="text" id="profile-cidade" placeholder="Cidade" class="input-chic col-span-2">
                            </div>
                            <input type="text" id="profile-rua" placeholder="Rua" class="input-chic mb-4">
                            <input type="text" id="profile-numero" placeholder="Número e Complemento" class="input-chic">
                        </div>

                        <button type="submit" class="btn-chic shadow-lg">Salvar Alterações</button>
                    </form>
                </div>
            </div>

            <!-- CHAT -->
            <div id="tab-chat" class="tab-content hidden h-full">
                <div class="bg-white border border-gray-100 shadow-sm flex flex-col h-[600px] max-h-[70vh] rounded-lg overflow-hidden">
                    <div class="p-4 border-b bg-gray-50 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="font-medium text-sm text-gray-700">Atendimento Online</span>
                        </div>
                        <span class="text-xs text-gray-400">Resposta em até 1h</span>
                    </div>
                    <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50/30"></div>
                    <form id="chat-form" class="p-4 border-t flex gap-3 bg-white">
                        <input type="text" id="message-input" class="flex-1 border-b border-gray-200 px-4 py-2 text-sm focus:border-[--cor-ouro] outline-none bg-transparent" placeholder="Digite sua dúvida...">
                        <button type="submit" class="text-[--cor-marrom] hover:text-[--cor-ouro] transition"><i class="fa-solid fa-paper-plane text-xl"></i></button>
                    </form>
                </div>
            </div>

        </main>
    </div>

    <script src="user.js"></script>
    <script>
        function buscarEndereco(cep) {
            cep = cep.replace(/\D/g, '');
            if(cep.length === 8) {
                const prefix = document.getElementById('view-register').classList.contains('active') ? 'reg' : 'profile';
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(res => res.json())
                    .then(data => {
                        if(!data.erro) {
                            const ruaEl = document.getElementById(`${prefix}-rua`);
                            const cidEl = document.getElementById(`${prefix}-cidade`);
                            if(ruaEl) ruaEl.value = data.logradouro;
                            if(cidEl) cidEl.value = `${data.localidade}/${data.uf}`;
                        }
                    });
            }
        }
    </script>
</body>
</html>
